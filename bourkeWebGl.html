<html>
<!-- 
Cody Smith (c) 2011

 -->

<head>
<title>SFX GRAPHICS cody smith</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script id="shader-fs" type="x-shader/x-fragment">
    #ifdef GL_ES
    precision highp float;
    #endif

	uniform sampler2D uSampler1;
	uniform float drawState;//0=normal, 1=x picking, 2.0 = y picking

    varying vec4 vColor;
	varying vec2 vTexPos;
	varying float vAlpha;

    void main(void) {
		vec4 texColor=vec4(1.0,1.0,0.0,1.0);

/*picking state  ( color coded positions)*/
		if( drawState==1.0)
		{
			//texColor = vec4( mod(vTexPos[0] * 256.0 * 256.0, 1.0)  , mod(vTexPos[0] * 256.0, 1.0), vTexPos[0] , 1.0);
			texColor = vec4( vTexPos.s, 0.0,  vTexPos.t, 1.0);
		}
		else /* normal state */
		{
			texColor =  texture2D( uSampler1, vec2( vTexPos.s, vTexPos.t) );
			texColor = texColor * vAlpha;
		}
   		

		gl_FragColor = texColor;
    }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec2 texturePos;
	attribute float alpha;
	
    varying vec4 vColor;
	varying vec2 vTexPos;
	varying float vAlpha;

	uniform mat4 textureMatrix;

	float bounce( float x)
	{
		float xa = abs(x);
		float x2 = mod(xa,2.0);
		float x3 = mod(xa,1.0);
		if( x2 > 1.0){
			x3 = 1.0 - x3;
		}
		return x3;
	}

    void main(void) {
		vec4 fck = vec4(texturePos, 0.0, 1.0); 
		fck = textureMatrix * fck;
		vTexPos = vec2( bounce(fck[0]), bounce(fck[1]) );
		
		vColor = vec4(vTexPos ,0.0, 1.0);
		//vColor = vec4(alpha,0.0,0.0,1.0);
       	gl_Position = vec4(aVertexPosition, 1.0);
		vAlpha = alpha;

    }


</script>

<script src="glMatrix.js"></script>
<script src='jquery-1.6.2.js'></script>
<script src='bourkeMeshParse.js'></script>
<script src='bourkeWebGl.js'></script>
<script src="keyAndMouse.js"></script>
<script>

var __BMESH = null;// mesh file 
var __BGL = null;// web gl instance
function loadFile()
{
	function loadedFile( data)
	{
		//this function is called when file is loaded
		 __BMESH = new parseMap( data);
		  
		 __BGL.vertices = __BMESH.xyTriangles;
		 __BGL.textureCoords = __BMESH.uvTriangles;
		 __BGL.alphas = __BMESH.alphaTriangles;
		 __BGL.webGLStart();
		 bindKeysAndMouse();
		 
		 __BGL.canvas.onclick=function(e){
			
			  //var buf = new Uint16Array( 4);
			  var buf = new Uint8Array( 4);
			  
			  __BGL.drawState=1
			  __BGL.display();
			  
			  console.log(gl.readPixels( e.pageX, __BGL.canvas.height - e.pageY, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, buf));

			  decode( buf);
			  
			  //console.log(gl.readPixels( e.pageX, e.pageY, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, buf));

			  //console.log("(", e.pageX, e.pageY,")", buf[0], buf[1], buf[2], buf[3]);
			    //console.log(buf);
			  decode( buf);
		 }
		 function decode(color){
			 console.log(color);
			var r = color[0];
			var g = color[1];
			var b = color[2];

			var x = (r/256.0) * __BGL.canvas.width;
			var y = (b/256.0) * __BGL.canvas.height;
			//var x1 = (r/256.0) * __BGL.canvas.width;
			//var x = (r/256.0 + (g)/(256.0*256.0)) * __BGL.canvas.width;
			console.log(" x ", x, " y ", y);
		 }
	}
	//open file
	__BGL = new glTemplate();
	__BGL.textureImageName="images/panda2.jpg";
	$.get('maps/xyuv.txt', loadedFile );	
	
	can3d = document.getElementById('canvas3d');
	//can3d.style
}
$.ready = loadFile;


</script>

</head>
<body bgcolor='black'>
    <canvas id="canvas3d" style="border: none; width:100%; height:100%; left:0px; top:0px; position:absolute; z-index:-1;"></canvas>
<div id='controls' style="z-index:+2;">
<a href="javascript:__BGL.attachVideo('images/Mario3_1111.ogv')" style="background-color:black;">attach mario video video</a>
<br>
<a href="javascript:__BGL.attachVideo('images/BrotherCanYouSpareAJob.ogv')" style="background-color:black;">attach political cartoon video</a>

</div>

</body>


</html>